<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Sequel::Fdbsql::DatabaseMethods</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>module</span>
          Sequel::Fdbsql::DatabaseMethods
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../files/lib/sequel/adapters/shared/fdbsql_rb.html">lib/sequel/adapters/shared/fdbsql.rb</a>
          </li>
        </ol>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>Methods shared by <a href="Database.html">Database</a> instances that
            connect to the FoundationDB <a href="../SQL.html">SQL</a> Layer</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-bound_variable_arg">bound_variable_arg</a></li>
              <li><a target="docwin" href="#attribute-i-conversion_procs">conversion_procs</a></li>
              <li><a target="docwin" href="#method-i-database_type">database_type</a></li>
              <li><a target="docwin" href="#method-i-foreign_key_list">foreign_key_list</a></li>
              <li><a target="docwin" href="#method-i-global_index_namespace-3F">global_index_namespace?</a></li>
              <li><a target="docwin" href="#method-i-indexes">indexes</a></li>
              <li><a target="docwin" href="#method-i-primary_key">primary_key</a></li>
              <li><a target="docwin" href="#method-i-serial_primary_key_options">serial_primary_key_options</a></li>
              <li><a target="docwin" href="#method-i-supports_create_table_if_not_exists-3F">supports_create_table_if_not_exists?</a></li>
              <li><a target="docwin" href="#method-i-supports_deferrable_foreign_key_constraints-3F">supports_deferrable_foreign_key_constraints?</a></li>
              <li><a target="docwin" href="#method-i-supports_drop_table_if_exists-3F">supports_drop_table_if_exists?</a></li>
              <li><a target="docwin" href="#method-i-tables">tables</a></li>
              <li><a target="docwin" href="#method-i-views">views</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>BOUND_VARIABLE_SQLTIME_FORMAT</td>
                    <td>=</td>
                    <td class='context-item-value'>"%H:%M:%S".freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>BOUND_VARIABLE_TIMESTAMP_FORMAT</td>
                    <td>=</td>
                    <td class='context-item-value'>"%Y-%m-%d %H:%M:%S".freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>the literal methods put quotes around things, but when we bind a variable
                      there shouldn&#39;t be quotes around it it should just be the timestamp, so
                      we need whole new formats here.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DATABASE_ERROR_REGEXPS</td>
                    <td>=</td>
                    <td class='context-item-value'>
                      [
                      # Add this check first, since otherwise it's possible for users to control
                      # which exception class is generated.
                      [/invalid input syntax/, DatabaseError],
                      # the rest of these are backups in case the sqlstate fails
                      [/[dD]uplicate key violates unique constraint/, UniqueConstraintViolation],
                      [/due (?:to|for) foreign key constraint/, ForeignKeyConstraintViolation],
                      [/NULL value not permitted/, NotNullConstraintViolation],
                      ].freeze
                    </td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>This is a fallback used by the base class if the sqlstate fails to figure
                      out what error type it is.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>FOREIGN_KEY_CONSTRAINT_SQLSTATES</td>
                    <td>=</td>
                    <td class='context-item-value'>%w'23503 23504'.freeze.each(&:freeze)</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>NOT_NULL_CONSTRAINT_SQLSTATES</td>
                    <td>=</td>
                    <td class='context-item-value'>%w'23502'.freeze.each(&:freeze)</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>STALE_STATEMENT_SQLSTATE</td>
                    <td>=</td>
                    <td class='context-item-value'>'0A50A'.freeze</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>UNIQUE_CONSTRAINT_SQLSTATES</td>
                    <td>=</td>
                    <td class='context-item-value'>%w'23501'.freeze.each(&:freeze)</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-conversion_procs'>conversion_procs</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>A hash of conversion procs, keyed by type integer (oid) and having callable
                      values for the conversion proc for that type.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-bound_variable_arg'>
                <a name='method-i-bound_variable_arg'></a>
                <div class='synopsis'>
                  <span class='name'>bound_variable_arg</span>
                  <span class='arguments'>(arg, conn)</span>
                </div>
                <div class='description'>
                  
                  <p>Convert given argument so that it can be used directly by pg.  Currently,
                  pg doesn&#39;t handle fractional seconds in Time/DateTime or blobs with
                  “0”, and it won&#39;t ever handle Sequel::SQLTime values correctly.  Only
                  public for use by the adapter, shouldn&#39;t be used by external code.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-bound_variable_arg-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-bound_variable_arg-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 25</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">bound_variable_arg</span>(<span class="ruby-identifier">arg</span>, <span class="ruby-identifier">conn</span>)&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>&#x000A;  <span class="ruby-comment"># TODO TDD it:</span>&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Blob</span>&#x000A;    <span class="ruby-comment"># the 1 means treat this as a binary blob</span>&#x000A;    {<span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arg</span>, <span class="ruby-value">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>}&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQLTime</span>&#x000A;    <span class="ruby-comment"># the literal methods put quotes around things, but this is a bound variable, so we can&#39;t use those</span>&#x000A;    <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-constant">BOUND_VARIABLE_SQLTIME_FORMAT</span>)&#x000A;  <span class="ruby-keyword">when</span> <span class="ruby-constant">DateTime</span>, <span class="ruby-constant">Time</span>&#x000A;    <span class="ruby-comment"># the literal methods put quotes around things, but this is a bound variable, so we can&#39;t use those</span>&#x000A;    <span class="ruby-identifier">from_application_timestamp</span>(<span class="ruby-identifier">arg</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-constant">BOUND_VARIABLE_TIMESTAMP_FORMAT</span>)&#x000A;  <span class="ruby-keyword">else</span>&#x000A;     <span class="ruby-identifier">arg</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-database_type'>
                <a name='method-i-database_type'></a>
                <div class='synopsis'>
                  <span class='name'>database_type</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p><a href="../Fdbsql.html">Fdbsql</a> uses the :fdbsql database type.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-database_type-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-database_type-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 43</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">database_type</span>&#x000A;  <span class="ruby-value">:fdbsql</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-foreign_key_list'>
                <a name='method-i-foreign_key_list'></a>
                <div class='synopsis'>
                  <span class='name'>foreign_key_list</span>
                  <span class='arguments'>(table, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Return full foreign key information, including <a
                  href="../Postgres.html">Postgres</a> returns hash like: {“b_e_fkey”=&gt;
                  {:name=&gt;:b_e_fkey, :<a href=":e">columns=></a>,
                  :on_update=&gt;:no_action, :on_delete=&gt;:no_action,
                  :deferrable=&gt;false, :table=&gt;:a, :<a href=":c">key=></a>}}</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-foreign_key_list-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-foreign_key_list-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 125</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">foreign_key_list</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">out_identifier</span>, <span class="ruby-identifier">in_identifier</span> = <span class="ruby-identifier">identifier_convertors</span>(<span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">table</span> = <span class="ruby-identifier">schema_or_current_and_table</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">sql_table</span> = <span class="ruby-identifier">in_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">table</span>)&#x000A;  <span class="ruby-identifier">columns_dataset</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:tc__table_name___table_name</span>,&#x000A;           <span class="ruby-value">:tc__table_schema___table_schema</span>,&#x000A;           <span class="ruby-value">:tc__is_deferrable___deferrable</span>,&#x000A;           <span class="ruby-value">:kc__column_name___column_name</span>,&#x000A;           <span class="ruby-value">:kc__constraint_schema___schema</span>,&#x000A;           <span class="ruby-value">:kc__constraint_name___name</span>,&#x000A;           <span class="ruby-value">:rc__update_rule___on_update</span>,&#x000A;           <span class="ruby-value">:rc__delete_rule___on_delete</span>).&#x000A;    <span class="ruby-identifier">from</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__table_constraints</span>, <span class="ruby-string">&#39;tc&#39;</span>)).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__key_column_usage</span>, <span class="ruby-string">&#39;kc&#39;</span>),&#x000A;         [<span class="ruby-value">:constraint_schema</span>, <span class="ruby-value">:constraint_name</span>]).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__referential_constraints</span>, <span class="ruby-string">&#39;rc&#39;</span>),&#x000A;         [<span class="ruby-value">:constraint_name</span>, <span class="ruby-value">:constraint_schema</span>]).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:tc__table_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sql_table</span>,&#x000A;          <span class="ruby-value">:tc__table_schema</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">schema</span>,&#x000A;          <span class="ruby-value">:tc__constraint_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;FOREIGN KEY&#39;</span>)&#x000A;&#x000A;  <span class="ruby-identifier">keys_dataset</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:rc__constraint_schema___schema</span>,&#x000A;           <span class="ruby-value">:rc__constraint_name___name</span>,&#x000A;           <span class="ruby-value">:kc__table_name___key_table</span>,&#x000A;           <span class="ruby-value">:kc__column_name___key_column</span>).&#x000A;    <span class="ruby-identifier">from</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__table_constraints</span>, <span class="ruby-string">&#39;tc&#39;</span>)).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__referential_constraints</span>, <span class="ruby-string">&#39;rc&#39;</span>),&#x000A;         [<span class="ruby-value">:constraint_schema</span>, <span class="ruby-value">:constraint_name</span>]).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__key_column_usage</span>, <span class="ruby-string">&#39;kc&#39;</span>),&#x000A;         <span class="ruby-value">:kc__constraint_schema</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:rc__unique_constraint_schema</span>,&#x000A;         <span class="ruby-value">:kc__constraint_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:rc__unique_constraint_name</span>).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:tc__table_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sql_table</span>,&#x000A;          <span class="ruby-value">:tc__table_schema</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">schema</span>,&#x000A;          <span class="ruby-value">:tc__constraint_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;FOREIGN KEY&#39;</span>)&#x000A;  <span class="ruby-identifier">foreign_keys</span> = {}&#x000A;  <span class="ruby-identifier">columns_dataset</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">foreign_key</span> = <span class="ruby-identifier">foreign_keys</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">foreign_keys</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]] = <span class="ruby-identifier">row</span>&#x000A;      <span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>] = <span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>])&#x000A;      <span class="ruby-identifier">row</span>[<span class="ruby-value">:columns</span>] = []&#x000A;      <span class="ruby-identifier">row</span>[<span class="ruby-value">:key</span>] = []&#x000A;      <span class="ruby-identifier">row</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">foreign_key</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column_name</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">keys_dataset</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">foreign_key</span> = <span class="ruby-identifier">foreign_keys</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]]&#x000A;    <span class="ruby-identifier">foreign_key</span>[<span class="ruby-value">:table</span>] = <span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:key_table</span>])&#x000A;    <span class="ruby-identifier">foreign_key</span>[<span class="ruby-value">:key</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:key_column</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">foreign_keys</span>.<span class="ruby-identifier">values</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-global_index_namespace-3F'>
                <a name='method-i-global_index_namespace-3F'></a>
                <div class='synopsis'>
                  <span class='name'>global_index_namespace?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>indexes are namespaced per table</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-global_index_namespace-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-global_index_namespace-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 54</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">global_index_namespace?</span>&#x000A;  <span class="ruby-keyword">false</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-indexes'>
                <a name='method-i-indexes'></a>
                <div class='synopsis'>
                  <span class='name'>indexes</span>
                  <span class='arguments'>(table, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Return indexes for the table postgres returns: {:blah_blah_index=&gt;{:<a
                  href=":n">columns=></a>, :unique=&gt;true, :deferrable=&gt;nil},</p>
                  
                  <pre>:items_n_a_index=&gt;{:columns=&gt;[:n, :a], :unique=&gt;false, :deferrable=&gt;nil}}</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-indexes-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-indexes-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 184</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">indexes</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">out_identifier</span>, <span class="ruby-identifier">in_identifier</span> = <span class="ruby-identifier">identifier_convertors</span>(<span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">table</span> = <span class="ruby-identifier">schema_or_current_and_table</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">dataset</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:is__is_unique</span>,&#x000A;           <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>({<span class="ruby-value">:is__is_unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;YES&#39;</span>}, <span class="ruby-string">&#39;unique&#39;</span>),&#x000A;           <span class="ruby-value">:is__index_name</span>,&#x000A;           <span class="ruby-value">:ic__column_name</span>).&#x000A;    <span class="ruby-identifier">from</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__indexes</span>, <span class="ruby-string">&#39;is&#39;</span>)).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__index_columns</span>, <span class="ruby-string">&#39;ic&#39;</span>),&#x000A;         <span class="ruby-value">:ic__index_table_schema</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:is__table_schema</span>,&#x000A;         <span class="ruby-value">:ic__index_table_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:is__table_name</span>,&#x000A;         <span class="ruby-value">:ic__index_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:is__index_name</span>).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:is__table_schema</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">schema</span>,&#x000A;          <span class="ruby-value">:is__table_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">in_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">table</span>)).&#x000A;    <span class="ruby-identifier">exclude</span>(<span class="ruby-value">:is__index_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;PRIMARY&#39;</span>)&#x000A;  <span class="ruby-identifier">indexes</span> = {}&#x000A;  <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">index</span> = <span class="ruby-identifier">indexes</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:index_name</span>])) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>&#x000A;      <span class="ruby-identifier">h</span> = { <span class="ruby-value">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">row</span>[<span class="ruby-value">:unique</span>], <span class="ruby-value">:columns</span> =<span class="ruby-operator">&gt;</span> [] }&#x000A;      <span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">h</span>&#x000A;      <span class="ruby-identifier">h</span>&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">index</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column_name</span>])&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">indexes</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-primary_key'>
                <a name='method-i-primary_key'></a>
                <div class='synopsis'>
                  <span class='name'>primary_key</span>
                  <span class='arguments'>(table_name, opts=OPTS)</span>
                </div>
                <div class='description'>
                  
                  <p>Return primary key for the given table.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-primary_key-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-primary_key-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 59</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">primary_key</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)&#x000A;  <span class="ruby-identifier">quoted_table</span> = <span class="ruby-identifier">quote_schema_table</span>(<span class="ruby-identifier">table_name</span>)&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-keyword">return</span> <span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_keys</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">quoted_table</span>)}&#x000A;  <span class="ruby-identifier">out_identifier</span>, <span class="ruby-identifier">in_identifier</span> = <span class="ruby-identifier">identifier_convertors</span>(<span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">table</span> = <span class="ruby-identifier">schema_or_current_and_table</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">opts</span>)&#x000A;  <span class="ruby-identifier">dataset</span> = <span class="ruby-identifier">metadata_dataset</span>.&#x000A;    <span class="ruby-identifier">select</span>(<span class="ruby-value">:kc__column_name</span>).&#x000A;    <span class="ruby-identifier">from</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__key_column_usage</span>, <span class="ruby-string">&#39;kc&#39;</span>)).&#x000A;    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-value">:information_schema__table_constraints</span>, <span class="ruby-string">&#39;tc&#39;</span>),&#x000A;         [<span class="ruby-value">:table_name</span>, <span class="ruby-value">:table_schema</span>, <span class="ruby-value">:constraint_name</span>]).&#x000A;    <span class="ruby-identifier">where</span>(<span class="ruby-value">:kc__table_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">in_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">table</span>),&#x000A;          <span class="ruby-value">:kc__table_schema</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">schema</span>,&#x000A;          <span class="ruby-value">:tc__constraint_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;PRIMARY KEY&#39;</span>)&#x000A;  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>&#x000A;    <span class="ruby-identifier">out_identifier</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:column_name</span>))&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">value</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">size</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span> <span class="ruby-keyword">nil</span>&#x000A;            <span class="ruby-keyword">when</span> <span class="ruby-value">1</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">first</span>&#x000A;            <span class="ruby-keyword">else</span> <span class="ruby-identifier">value</span>&#x000A;          <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@primary_keys</span>[<span class="ruby-identifier">quoted_table</span>] = <span class="ruby-identifier">value</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-serial_primary_key_options'>
                <a name='method-i-serial_primary_key_options'></a>
                <div class='synopsis'>
                  <span class='name'>serial_primary_key_options</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>like PostgreSQL fdbsql uses SERIAL psuedo-type instead of AUTOINCREMENT for
                  managing incrementing primary keys.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-serial_primary_key_options-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-serial_primary_key_options-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 49</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">serial_primary_key_options</span>&#x000A;  {<span class="ruby-value">:primary_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:serial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:type=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Integer</span>}&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_create_table_if_not_exists-3F'>
                <a name='method-i-supports_create_table_if_not_exists-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_create_table_if_not_exists?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>the sql layer supports CREATE TABLE IF NOT EXISTS syntax,</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_create_table_if_not_exists-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_create_table_if_not_exists-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 84</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_create_table_if_not_exists?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_deferrable_foreign_key_constraints-3F'>
                <a name='method-i-supports_deferrable_foreign_key_constraints-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_deferrable_foreign_key_constraints?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p><a href="../Fdbsql.html">Fdbsql</a> supports deferrable fk constraints</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_deferrable_foreign_key_constraints-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_deferrable_foreign_key_constraints-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 89</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_deferrable_foreign_key_constraints?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-supports_drop_table_if_exists-3F'>
                <a name='method-i-supports_drop_table_if_exists-3F'></a>
                <div class='synopsis'>
                  <span class='name'>supports_drop_table_if_exists?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>the sql layer supports DROP TABLE IF EXISTS</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-supports_drop_table_if_exists-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-supports_drop_table_if_exists-3F-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 94</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">supports_drop_table_if_exists?</span>&#x000A;  <span class="ruby-keyword">true</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-tables'>
                <a name='method-i-tables'></a>
                <div class='synopsis'>
                  <span class='name'>tables</span>
                  <span class='arguments'>(opts=OPTS, &block)</span>
                </div>
                <div class='description'>
                  
                  <p>Array of symbols specifying table names in the current database. The
                  dataset used is yielded to the block if one is provided, otherwise, an
                  array of symbols of table names is returned.</p>
                  
                  <p>Options:</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:qualify </td><td>
                  <p>Return the tables as Sequel::SQL::QualifiedIdentifier instances, using the
                  schema the table is located in as the qualifier.</p>
                  </td></tr><tr><td class='label'>:schema </td><td>
                  <p>The schema to search</p>
                  </td></tr><tr><td class='label'>:server </td><td>
                  <p>The server to use</p>
                  </td></tr></tbody></table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-tables-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-tables-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 107</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">tables</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">tables_or_views</span>(<span class="ruby-string">&#39;TABLE&#39;</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-views'>
                <a name='method-i-views'></a>
                <div class='synopsis'>
                  <span class='name'>views</span>
                  <span class='arguments'>(opts=OPTS, &block)</span>
                </div>
                <div class='description'>
                  
                  <p>Array of symbols specifying view names in the current database.</p>
                  
                  <p>Options:</p>
                  <table class="rdoc-list note-list"><tbody><tr><td class='label'>:qualify </td><td>
                  <p>Return the views as Sequel::SQL::QualifiedIdentifier instances, using the
                  schema the view is located in as the qualifier.</p>
                  </td></tr><tr><td class='label'>:schema </td><td>
                  <p>The schema to search</p>
                  </td></tr><tr><td class='label'>:server </td><td>
                  <p>The server to use</p>
                  </td></tr></tbody></table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-views-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-views-source'><span class="ruby-comment"># File lib/sequel/adapters/shared/fdbsql.rb, line 118</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">views</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;  <span class="ruby-identifier">tables_or_views</span>(<span class="ruby-string">&#39;VIEW&#39;</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
